from typing import List
from collections import Counter


class Solution:
    def minMalwareSpread(self, graph: List[List[int]],
                         initial: List[int]) -> int:
        def dfs(u, r):
            if root[u] != -1:
                return
            root[u] = r
            cnt[r] += 1
            for v, val in enumerate(graph[u]):
                if val == 1:
                    dfs(v, r)

        root = [-1] * len(graph)
        cnt = [0] * len(graph)
        for i in initial:
            dfs(i, i)

        root_counter: Counter = Counter()
        for i in initial:
            root_counter[root[i]] += 1

        res = -1
        for i in initial:
            r = root[i]
            if root_counter[r] == 1:
                if res == -1:
                    res = i
                elif cnt[r] > cnt[root[res]]:
                    res = i
                elif cnt[r] == cnt[root[res]] and i < res:
                    res = i

        if res == -1:
            return min(initial)
        else:
            return res
